<?phpnamespace app\app\controller\mission_new;use app\app\controller\BaseController;use app\app\library\Gold;use app\app\library\GoldRunExt;use app\app\library\UserTackRecord;use app\model\GoldRun;use app\model\User;use app\model\UserTaskRecord;use think\Db;use app\model\GoldProductRecord;use time\TimeUtil;class HighQualityComments  implements MissionInterface{    const MAX_LIKE_COUNT = 5;//点赞数量达到多少，发放金币    private static $GOLD_RUN_ID = 4;    private static $GOLD_RUN_KEY_CODE = 'high_quality_review_awards';    /**     * @var GoldRun     */    protected $goldRun = null;    function _initGoldRun(&$goldRun)    {        $this->goldRun = $goldRun;    }    /**     * @return array|mixed     */    function info()    {        return out();    }    /**     *      */    function handler(){    }    /**     *     * 处理优质评论     * @return array|mixed     * @throws     */    function run(&$data)    {        return true;        $count = $data['like_count'] ;;        if(empty($data['user_id'])){            return false;        }        if($count < self::MAX_LIKE_COUNT || $data['is_add_gold'] !=1){            return false;        }        $this->goldRun = GoldRun::find(self::$GOLD_RUN_ID);         //匿名执行        $func = function () use (&$data)        {            UserTackRecord::createRecord($data['user_id'],$this->goldRun['key_code']);        };        //默认数据        $goldData = [            'user_id'=>$data['user_id']            ,'gold_tribute'=>$this->goldRun['gold_flag']            ,'status'=>1            ,'type'=>$this->goldRun['id']            ,'type_key'=>$this->goldRun['key_code']            ,'title'=>$this->goldRun['title']            ,'func'=>$func        ];        Gold::addUserGold($goldData);        return true;    }}